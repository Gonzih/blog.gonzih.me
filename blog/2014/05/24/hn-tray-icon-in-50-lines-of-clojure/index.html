    <!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.79.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>HN Tray icon in 50 lines of Clojure &middot; Max Gonzih</title>
  

  
  <link rel="stylesheet" href="https://blog.gonzih.me/css/poole.css">
  <link rel="stylesheet" href="https://blog.gonzih.me/css/hyde.css">
  <link rel="stylesheet" href="https://blog.gonzih.me/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Max Gonzih" />

  
  
      <script id="dsq-count-scr" src="//gonzihsblog.disqus.com/count.js" async></script>
  
</head>

    <body class=" ">
        <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://blog.gonzih.me/"><h1>Max Gonzih</h1></a>
      <p class="lead">
       KEEP CALM and CODE ON 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
        <li><a href="mailto:gonzih@gmail.com"> Email </a></li>
      
        <li><a href="https://github.com/Gonzih"> Github </a></li>
      
        <li><a href="https://blog.gonzih.me/index.xml"> RSS feed </a></li>
      
        <li><a href="https://gonzih.me"> Homepage </a></li>
      
        <li><a href="/post/"> Archives </a></li>
      
    </ul>

    <p>This work is licensed under a Creative Commons Attribution 4.0 International License.</p>
    <p class="cc-logo"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></p>
  </div>
</div>


        <div class="content container">
            <div class="post">
                <h1>HN Tray icon in 50 lines of Clojure</h1>
              <span class="post-date">Sat, May 24, 2014</span>
                  <p>Today I got a little bit bored and spend few hours poking around with java.awt in Clojure.
Result is tray app that shows stories from HN front page.
Just in ~50 lines of Clojure code.
Enjoy!</p>
<p><a href="https://github.com/Gonzih/hn-tray.clj">Github Project.</a></p>
<p>Source code is below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">ns </span>hn.core
  (<span style="color:#e6db74">:require</span> [cheshire.core <span style="color:#e6db74">:as</span> json]
            [clojure.java.browse <span style="color:#e6db74">:refer</span> [browse-url]]
            [clojure.java.io <span style="color:#e6db74">:refer</span> [resource]])
  (<span style="color:#e6db74">:import</span> [java.awt SystemTray TrayIcon PopupMenu MenuItem Toolkit]
           [java.awt.event ActionListener])
  (<span style="color:#e6db74">:gen-class</span>))

(<span style="color:#66d9ef">defn </span>menu-item [label callback]
  (<span style="color:#66d9ef">let </span>[menu (<span style="color:#a6e22e">MenuItem.</span> label)
        listener (proxy [ActionListener] []
                   (<span style="color:#a6e22e">actionPerformed</span> [event] (<span style="color:#a6e22e">callback</span>)))]
    (<span style="color:#a6e22e">.addActionListener</span> menu listener)
    menu))

(<span style="color:#66d9ef">def </span>hn-api-url <span style="color:#e6db74">&#34;https://api.ihackernews.com/page&#34;</span>)

(<span style="color:#66d9ef">defn </span>hn-items []
  (-&gt; hn-api-url
      slurp
      (<span style="color:#a6e22e">json/parse-string</span> true)
      <span style="color:#e6db74">:items</span>
      (<span style="color:#f92672">#</span>(sort-by <span style="color:#e6db74">:points</span> %))
      reverse))

(<span style="color:#66d9ef">defn </span>add-hn-to-menu! [menu]
  (<span style="color:#a6e22e">letfn</span> [(<span style="color:#a6e22e">mapfn</span> [{<span style="color:#e6db74">:keys</span> [title url commentCount points]}]
            (<span style="color:#66d9ef">let </span>[full-title (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%-4s (%-4s) - %s&#34;</span> points commentCount title)
                  menu-item (<span style="color:#a6e22e">menu-item</span> full-title <span style="color:#f92672">#</span>(<span style="color:#a6e22e">browse-url</span> url))]
              (println full-title)
              (<span style="color:#a6e22e">.add</span> menu menu-item)))]
  (doall (map mapfn (<span style="color:#a6e22e">hn-items</span>)))))

(<span style="color:#66d9ef">defn </span>exit []
  (<span style="color:#a6e22e">shutdown-agents</span>)
  (<span style="color:#a6e22e">System/exit</span> <span style="color:#ae81ff">0</span>))

(<span style="color:#66d9ef">defn </span>-main [<span style="color:#f92672">&amp;</span> args]
  (<span style="color:#66d9ef">let </span>[tray (<span style="color:#a6e22e">SystemTray/getSystemTray</span>)
        image (<span style="color:#a6e22e">.getImage</span> (<span style="color:#a6e22e">Toolkit/getDefaultToolkit</span>)
                         (<span style="color:#a6e22e">resource</span> <span style="color:#e6db74">&#34;icon.png&#34;</span>))
        icon (<span style="color:#a6e22e">TrayIcon.</span> image)
        exit (<span style="color:#a6e22e">menu-item</span> <span style="color:#e6db74">&#34;Exit&#34;</span> exit)]
    (<span style="color:#a6e22e">.setImageAutoSize</span> icon true)
    (<span style="color:#a6e22e">.add</span> tray icon)
    (<span style="color:#66d9ef">loop </span>[]
      (<span style="color:#66d9ef">let </span>[popup (<span style="color:#a6e22e">PopupMenu.</span>)]
        (println <span style="color:#e6db74">&#34;Updating items&#34;</span>)
        (<span style="color:#a6e22e">add-hn-to-menu!</span> popup)
        (<span style="color:#a6e22e">.add</span> popup exit)
        (<span style="color:#a6e22e">.setPopupMenu</span> icon popup)
        (<span style="color:#a6e22e">Thread/sleep</span> (* <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">60</span> <span style="color:#ae81ff">1000</span>))
        (<span style="color:#a6e22e">recur</span>)))))
</code></pre></div>
            </div>

            
                <h2>Comments</h2>
                <div id="disqus_thread"></div>
<script type="text/javascript">
     
    var disqus_shortname = 'gonzihsblog'; 

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        </div>

  </body>
</html>
